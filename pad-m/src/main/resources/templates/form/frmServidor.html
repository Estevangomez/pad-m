<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout.html}">
<head>
<style>
.card-header {
	background-color: #00537d;
}
</style>
</head>
<body>
	<section layout:fragment="content">
		<div class="card m-4 shadow-lg rounded">
			<div class="card-header text-white text-center fw-bold fs-5">Cadastro
				de Servidor</div>
				
			<div class="card-body bg-light p-4 rounded">
				<form th:action="@{/servidores/save}" th:object="${servidor}"
					method="post" class="row g-3" id="frm">
					<input type="hidden" th:field="*{id}">

					<div class="col-md-6">
						<label for="nome" class="form-label fw-bold">Nome</label> <input
							type="text" id="nome" class="form-control" th:field="*{nome}"
							placeholder="Digite o nome">
						<div th:if="${#fields.hasErrors('nome')}"
							class="text-danger small">
							<span th:errors="*{nome}"></span>
						</div>
					</div>

					<div class="col-md-6">
						<label for="cpf" class="form-label fw-bold">CPF</label> <input
							type="text" id="cpf" class="form-control" th:field="*{cpf}"
							placeholder="Digite o CPF" maxlength="11">
						<div id="cpf-mensagem"></div>
					</div>

					<div class="col-md-6">
						<label for="nickname" class="form-label fw-bold">Nome
							Reduzido</label> <input type="text" id="nickname" class="form-control"
							th:field="*{nomereduzido}" placeholder="">
					</div>

					<div class="col-md-6">
						<label for="rg" class="form-label fw-bold">RG</label> <input
							type="text" id="rg" class="form-control" th:field="*{rg}"
							placeholder="">
					</div>

					<div class="col-md-6">
						<label for="setor" class="form-label fw-bold">Setor</label> <select
							id="setor" class="form-select" th:field="*{setorlotacaoId}">
							<option value="0">Selecione o Setor</option>
							<option th:each="setor : ${setores}" th:text="${setor.nome}"
								th:value="${setor.id}"></option>
						</select>
					</div>

					<div class="col-md-6">
						<label for="cargofuncao" class="form-label fw-bold">Cargo
							Função</label> <input type="text" id="cargofuncao" class="form-control"
							th:field="*{cargofuncao}" placeholder="">
					</div>

					<div class="col-md-6">
						<label for="email" class="form-label fw-bold">Email</label> <input
							type="email" id="email" class="form-control" th:field="*{email}"
							placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="endereco" class="form-label">Endereço</label> <input
							type="text" id="endereco" class="form-control"
							th:field="*{endereco}" placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="numero" class="form-label">Número</label> <input
							type="text" id="numero" class="form-control" th:field="*{numero}"
							placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="bairro" class="form-label">Bairro</label> <input
							type="text" id="bairro" class="form-control" th:field="*{bairro}"
							placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="complemento" class="form-label">Complemento</label> <input
							type="text" id="complemento" class="form-control"
							th:field="*{complemento}" placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="cidade" class="form-label">Cidade</label> <input
							type="text" id="cidade" class="form-control" th:field="*{cidade}"
							placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="cep" class="form-label">CEP</label> <input type="text"
							id="cep" class="form-control" th:field="*{cep}" placeholder="">
					</div>

					<div class="col-md-6">
						<label for="telefone1" class="form-label fw-bold">Telefone
							1</label> <input type="text" id="telefone1" class="form-control"
							th:field="*{telefone1}" placeholder="">
					</div>

					<div class="col-md-6">
						<label for="telefone2" class="form-label fw-bold">Telefone
							2</label> <input type="text" id="telefone2" class="form-control"
							th:field="*{telefone2}" placeholder="">
					</div>

					<div class="col-md-6">
						<label for="dataadmissao" class="form-label fw-bold">Data
							Admissão</label> <input type="date" id="dataadmissao"
							class="form-control" name="admissao">
					</div>

					<div class="col-md-6">
						<label for="datadesligamento" class="form-label fw-bold">Data
							Desligamento</label> <input type="date" id="datadesligamento"
							class="form-control" name="desligamento">
					</div>

					<div class="col-md-6 mb-3">
						<label for="contratoId" class="form-label">Contrato</label> <input
							type="text" id="contratoId" class="form-control"
							th:field="*{contratoId}" placeholder="">
					</div>
					<div class="col-md-6 mb-3">
						<label for="perfilId" class="form-label">Perfil</label> <input
							type="text" id="perfilId" class="form-control"
							th:field="*{perfilId}" placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="certificado" class="form-label">Certificado</label> <input
							type="text" id="certificado" class="form-control"
							th:field="*{certificado}" placeholder="">
					</div>

					<div class="col-md-6 mb-3">
						<label for="dataexpiracao" class="form-label">Data
							Expiração</label> <input type="date" id="dataexpiracao" name="expiracao"
							class="form-control" placeholder="">
					</div>


					<div class="col-12 text-center mt-4">
						<button type="button" id="salvar" class="btn btn-primary px-4 py-2 shadow-sm">Salvar</button>
					</div>
				</form>
			</div>
		</div>
	</section>

	<div layout:fragment="jscript">
		<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<script
			src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
		<script
			src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

		<script>
                
            $("#loader").show();
            $(document).ready(function() {
            	 var URL = '[[@{/}]]api';      
                $("#loader").hide();
                $("#salvar").click(function(event) {
                    event.preventDefault();
                    var data = $(event.delegateTarget).data();
                    var id = data.recordId;
                    swal({
                        title: 'Salvar?',
                        text: "Deseja salvar novo Usuario?",
                        icon: 'warning',
                        buttons: [true, "Sim Salvar!"]
                    }).then((result) => {
                        if (result) {
                        	$("#loader").show();
                            var frm = $("#frm").submit();
                        }
                    })
                });
            });
            
            
            
            $("#orgao").change(function(){
            	 var URL = '[[@{/}]]api';     
            	 var orgao = $("#orgao").val();
            	 
            	 $.ajax({
           		  url: URL + "/localidades/orgao/"+orgao,
           		  method: "GET",
           		}).done(function(data) {
           			$('#localidade').append($('<option>', {value: 0, text : "Selecione a Localidade" }));
           			$.each( data, function( index, rs ){
           				$('#localidade').append($('<option>', { 
           			        value: rs.id,
           			        text : rs.nome 
           			    }));
           			});
           			 $("#loader").hide();
           		}); 
            	
             });
            
            
            $("#localidade").change(function(){
             var orgao = $("#orgao").val();
           	 var localidade = $("#localidade").val();
           	 
           	 $.ajax({
          		  url: URL + "/unidades/orgao/"+orgao+"/localidade/"+localidade,
          		  method: "GET",
          		}).done(function(data) {
          			$('#unidade').append($('<option>', {value: 0, text : "Selecione a Unidade" }));
          			$.each( data, function( index, rs ){
          				$('#unidade').append($('<option>', { 
          			        value: rs.id,
          			        text : rs.nome 
          			    }));
          			});
          			 $("#loader").hide();
          		}); 
           	
            });
            
            $("#unidade").change(function(){
                 var orgao = $("#orgao").val();
              	 var localidade = $("#localidade").val();
              	 var unidade = $("#unidade").val();
              	 
              	 $.ajax({
             		  url: URL + "/setores/orgao/"+orgao+"/localidade/"+localidade+"/unidade/"+unidade,
             		  method: "GET",
             		}).done(function(data) {
             			$('#setor').append($('<option>', {value: 0, text : "Selecione o Setor" }));
             			$.each( data, function( index, rs ){
             				$('#setor').append($('<option>', { 
             			        value: rs.id,
             			        text : rs.nome 
             			    }));
             			});
             			 $("#loader").hide();
             		}); 
              	
               });
            
    
            $('#cpf').on('keyup', function() {
                const cpf = $(this).val().replace(/\D/g, ''); // Remove caracteres não numéricos
                const valido = validarCPF(cpf); // Usa a função de validação que já mostrei 
                
                // Atualiza a mensagem
                if (cpf.length === 0) { 
                    $('#cpf-mensagem').html('').removeClass();
                } else if (valido) {
                    $('#cpf-mensagem').html('CPF válido ✅').removeClass().addClass('valido');
                } else {
                    $('#cpf-mensagem').html('CPF inválido ❌').removeClass().addClass('invalido');
                }
            });          
        
            
        </script>
	</div>
</body>
</html>
